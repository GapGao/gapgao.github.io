<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>umi实战笔记 | 牛轰轰可能是个bug</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="介绍umi 是蚂蚁金服的底层前端框架umi，中文可发音为乌米，是一个可插拔的企业级 react 应用框架。umi 以路由为基础的，支持类 next.js 的约定式路由，以及各种进阶的路由功能，并以此进行功能扩展，比如支持路由级的按需加载。然后配以完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求，目前内外部加起来已有 50+ 的插件。">
<meta name="keywords" content="react,umi,antd">
<meta property="og:type" content="article">
<meta property="og:title" content="umi实战笔记">
<meta property="og:url" content="https://gapgao.github.io/2019/05/09/umi实战笔记/index.html">
<meta property="og:site_name" content="牛轰轰可能是个bug">
<meta property="og:description" content="介绍umi 是蚂蚁金服的底层前端框架umi，中文可发音为乌米，是一个可插拔的企业级 react 应用框架。umi 以路由为基础的，支持类 next.js 的约定式路由，以及各种进阶的路由功能，并以此进行功能扩展，比如支持路由级的按需加载。然后配以完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求，目前内外部加起来已有 50+ 的插件。">
<meta property="og:locale" content="Chinese">
<meta property="og:image" content="https://gapgao.github.io/img/umi/antd-design-pro-menu.png">
<meta property="og:image" content="https://gapgao.github.io/img/umi/antd-umi.png">
<meta property="og:image" content="https://gapgao.github.io/img/umi/app-menu.png">
<meta property="og:image" content="https://gapgao.github.io/img/umi/app-umi.png">
<meta property="og:updated_time" content="2024-01-04T08:04:02.208Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="umi实战笔记">
<meta name="twitter:description" content="介绍umi 是蚂蚁金服的底层前端框架umi，中文可发音为乌米，是一个可插拔的企业级 react 应用框架。umi 以路由为基础的，支持类 next.js 的约定式路由，以及各种进阶的路由功能，并以此进行功能扩展，比如支持路由级的按需加载。然后配以完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求，目前内外部加起来已有 50+ 的插件。">
<meta name="twitter:image" content="https://gapgao.github.io/img/umi/antd-design-pro-menu.png">
  
    <link rel="alternative" href="/atom.xml" title="牛轰轰可能是个bug" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head1.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">GapGao</a></h1>
        </hgroup>

        
        <p class="header-subtitle">但行好事 莫问前程</p>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="search" placeholder=" Search...">
            </form>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/works">作品展示</a></li>
                        
                            <li><a href="/about">留言打卡</a></li>
                        
                            <li><a href="/FrontEndGuide">前端导航</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                
                                    <a class="fl mail" target="_self" href="mailto:gaobo_1994@126.com" title="mail">mail</a>

                                
                            
                                
                                    <a class="fl github" target="_blank" href="https://github.com/GapGao" title="github">github</a>
                                
                            
                                
                                    <a class="fl weibo" target="_blank" href="https://weibo.com/u/3812290780" title="weibo">weibo</a>
                                
                            
                                
                                    <a class="fl linkedin" target="_blank" href="https://www.linkedin.com/in/博-高-544345139" title="linkedin">linkedin</a>
                                
                            
                                
                                    <a class="fl QQ" target="_self" href="/qq" title="QQ">QQ</a>

                                
                            
                                
                                    <a class="fl wechat" target="_self" href="/wechat" title="wechat">wechat</a>

                                
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/AST/" style="font-size: 10px;">AST</a> <a href="/tags/CJS/" style="font-size: 10px;">CJS</a> <a href="/tags/Cypress/" style="font-size: 10px;">Cypress</a> <a href="/tags/Deno/" style="font-size: 10px;">Deno</a> <a href="/tags/E2E测试测试/" style="font-size: 10px;">E2E测试测试</a> <a href="/tags/ESM/" style="font-size: 10px;">ESM</a> <a href="/tags/Nuxt/" style="font-size: 10px;">Nuxt</a> <a href="/tags/Proxy/" style="font-size: 10px;">Proxy</a> <a href="/tags/UMD/" style="font-size: 10px;">UMD</a> <a href="/tags/WebAssembly/" style="font-size: 10px;">WebAssembly</a> <a href="/tags/antd/" style="font-size: 10px;">antd</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/console/" style="font-size: 10px;">console</a> <a href="/tags/device/" style="font-size: 10px;">device</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/express/" style="font-size: 10px;">express</a> <a href="/tags/fiber/" style="font-size: 10px;">fiber</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/migration/" style="font-size: 10px;">migration</a> <a href="/tags/parcel/" style="font-size: 10px;">parcel</a> <a href="/tags/react/" style="font-size: 15px;">react</a> <a href="/tags/react15/" style="font-size: 10px;">react15</a> <a href="/tags/react16/" style="font-size: 10px;">react16</a> <a href="/tags/rollup/" style="font-size: 10px;">rollup</a> <a href="/tags/umi/" style="font-size: 10px;">umi</a> <a href="/tags/vconsole/" style="font-size: 10px;">vconsole</a> <a href="/tags/vite/" style="font-size: 10px;">vite</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/vue3/" style="font-size: 10px;">vue3</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/wechat/" style="font-size: 15px;">wechat</a> <a href="/tags/前端/" style="font-size: 20px;">前端</a> <a href="/tags/前端前沿/" style="font-size: 10px;">前端前沿</a> <a href="/tags/单元测试/" style="font-size: 10px;">单元测试</a> <a href="/tags/小程序/" style="font-size: 10px;">小程序</a> <a href="/tags/打包/" style="font-size: 10px;">打包</a> <a href="/tags/真机调试/" style="font-size: 10px;">真机调试</a> <a href="/tags/移动端/" style="font-size: 10px;">移动端</a> <a href="/tags/自动化测试/" style="font-size: 15px;">自动化测试</a> <a href="/tags/飞冰/" style="font-size: 10px;">飞冰</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.mokahr.com/">mokahr</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://app.mokahr.com/">mokahr-app</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">爱运动、爱交友、爱旅行、喜欢接触新鲜事物、迎接新的挑战，更爱游离于错综复杂的编码与逻辑中</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">GapGao</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head1.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">GapGao</a></h1>
            </hgroup>
            
            <p class="header-subtitle">但行好事 莫问前程</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/works">作品展示</a></li>
                
                    <li><a href="/about">留言打卡</a></li>
                
                    <li><a href="/FrontEndGuide">前端导航</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        
                            <a class="mail" target="_self" href="mailto:gaobo_1994@126.com" title="mail">mail</a>
                        
                    
                        
                            <a class="github" target="_blank" href="https://github.com/GapGao" title="github">github</a>
                        
                    
                        
                            <a class="weibo" target="_blank" href="https://weibo.com/u/3812290780" title="weibo">weibo</a>
                        
                    
                        
                            <a class="linkedin" target="_blank" href="https://www.linkedin.com/in/博-高-544345139" title="linkedin">linkedin</a>
                        
                    
                        
                            <a class="QQ" target="_self" href="/qq" title="QQ">QQ</a>
                        
                    
                        
                            <a class="wechat" target="_self" href="/wechat" title="wechat">wechat</a>
                        
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-umi实战笔记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/05/09/umi实战笔记/" class="article-date">
      <time datetime="2019-05-09T13:42:45.000Z" itemprop="datePublished">2019-05-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      umi实战笔记
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/web/">web</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/antd/">antd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/">react</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/umi/">umi</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>umi 是蚂蚁金服的底层前端框架<br>umi，中文可发音为乌米，是一个可插拔的企业级 react 应用框架。umi 以路由为基础的，支持类 next.js 的约定式路由，以及各种进阶的路由功能，并以此进行功能扩展，比如支持路由级的按需加载。然后配以完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求，目前内外部加起来已有 50+ 的插件。</p>
<a id="more"></a>
<h1 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h1><p>📦 开箱即用，内置 react、react-router 等<br>🏈 类 next.js 且功能完备的路由约定，同时支持配置的路由方式<br>🎉 完善的插件体系，覆盖从源码到构建产物的每个生命周期<br>🚀 高性能，通过插件支持 PWA、以路由为单元的 code splitting 等<br>💈 支持静态页面导出，适配各种环境，比如中台业务、无线业务、egg、支付宝钱包、云凤蝶等<br>🚄 开发启动快，支持一键开启 dll 和 hard-source-webpack-plugin 等<br>🐠 一键兼容到 IE9，基于 umi-plugin-polyfills<br>🍁 完善的 TypeScript 支持，包括 d.ts 定义和 umi test<br>🌴 与 dva 数据流的深入融合，支持 duck directory、model 的自动加载、code splitting 等等<br>后边的不复制了 -&gt; <a href="https://umijs.org/zh/guide" target="_blank" rel="noopener">https://umijs.org/zh/guide</a> umi官方文档</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><blockquote>
<p>1.安装node 8.1x<br>2.yarn global add umi 或者 npm i umi -g 推荐使用yarn 本文后续都使用yarn进行管理</p>
</blockquote>
<h1 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h1><blockquote>
<p>1.mkdir myapp &amp;&amp; cd myapp<br>2.使用脚手架搭建项目<br>yarn create umi 使用create-umi脚手架来快速创建项目代码</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">? Select the boilerplate <span class="built_in">type</span> (Use arrow keys)</span><br><span class="line">  ant-design-pro  - 包含 antd-pro布局的脚手架</span><br><span class="line">❯ app             - 通用项目脚手架</span><br><span class="line">  block           - Create a umi block.</span><br><span class="line">  library         - 区块脚手架，页面级别的可复用的代码，可以实现页面的按需加载，目前暂不清楚区块和插 件的区别</span><br><span class="line">  plugin          - umi插件框架</span><br><span class="line"></span><br><span class="line">  Do you want to use typescript? (y/N) 本博主暂时不会 后面会学习使用 选N</span><br><span class="line">  (然后选择需要的功能,这里列出的都是umi的默认插件，根据需要选择)</span><br><span class="line"></span><br><span class="line">? What functionality <span class="keyword">do</span> you want to <span class="built_in">enable</span>?</span><br><span class="line">  (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)</span><br><span class="line">❯ ◯ antd                  - antd组件库 选中</span><br><span class="line">  ◯ dva                   - dva 首先是一个基于 redux 和 redux-saga 的数据流方案，</span><br><span class="line">                            然后为了简化开发体验，dva 还额外内置了 react-router 和 fetch，所以也可以理解为一个</span><br><span class="line">                            轻量级的应用框架。 选中</span><br><span class="line">  ◯ code splitting        - webpack 实现按需加载的</span><br><span class="line">  ◯ dll                   - 通过 webpack 的 dll 插件预打包一份 dll 文件来达到二次启动提速的目的。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>4.这里为了快速熟悉umi先用antd(ant-design-pro)布局的搭建一个小项目</p>
<blockquote>
<p>1.创建好之后 执行 yarn 安装依赖<br>文件目录：<br><img src="/img/umi/antd-design-pro-menu.png" alt="avatar"><br>2.yarn start 启动项目<br>效果：<br><img src="/img/umi/antd-umi.png" alt="avatar"><br>…<br>看完这个项目之后，我发现都是一些比较个性化的配置，不适合初学者使用学习，<br>放弃，回归到选用app，搭建一个通用项目来学习，很尴尬</p>
</blockquote>
</blockquote>
<blockquote>
<p>5.搭建一个通用项目</p>
<blockquote>
<p>1.yarn create umi<br>2.选择 app -&gt; use typescript N -&gt; [antd, dva, code splitting]<br>3.yarn 安装依赖<br>目录：<br><img src="/img/umi/app-menu.png" alt="avatar"><br>4.yarn start<br>效果：<br><img src="/img/umi/app-umi.png" alt="avatar"></p>
</blockquote>
</blockquote>
<h1 id="文件目录介绍"><a href="#文件目录介绍" class="headerlink" title="文件目录介绍"></a>文件目录介绍</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist/                          // 默认的 build 输出目录</span><br><span class="line">├── mock/                          // mock 文件所在目录，基于 express</span><br><span class="line">├── config/</span><br><span class="line">    ├── config.js                  // umi 配置，同 .umirc.js，二选一</span><br><span class="line">└── src/                           // 源码目录，可选</span><br><span class="line">    ├── layouts/index.js           // 全局布局</span><br><span class="line">    ├── pages/                     // 页面目录，里面的文件即路由</span><br><span class="line">        ├── .umi/                  // dev 临时目录，需添加到 .gitignore</span><br><span class="line">        ├── .umi-production/       // build 临时目录，会自动删除</span><br><span class="line">        ├── document.ejs           // HTML 模板</span><br><span class="line">        ├── 404.js                 // 404 页面</span><br><span class="line">        ├── page1.js               // 页面 1，任意命名，导出 react 组件</span><br><span class="line">        ├── page1.test.js          // 用例文件，umi <span class="built_in">test</span> 会匹配所有 .test.js 和 .e2e.js 结尾的文件</span><br><span class="line">        └── page2.js               // 页面 2，任意命名</span><br><span class="line">    ├── global.css                 // 约定的全局样式文件，自动引入，也可以用 global.less</span><br><span class="line">    ├── global.js                  // 可以在这里加入 polyfill</span><br><span class="line">    ├── app.js                     // 运行时配置文件</span><br><span class="line">├── .umirc.js                      // umi 配置，同 config/config.js，二选一</span><br><span class="line">├── .env                           // 环境变量</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>
<h2 id="ES6-语法"><a href="#ES6-语法" class="headerlink" title="ES6 语法"></a>ES6 语法</h2><p>配置文件、mock 文件等都有通过 @babel/register 注册实时编译，所以可以和 src 里的文件一样，使用 ES6 的语法和 es modules 。</p>
<h2 id="dist"><a href="#dist" class="headerlink" title="dist"></a>dist</h2><p>默认输出路径，可通过配置 outputPath 修改。</p>
<h2 id="mock"><a href="#mock" class="headerlink" title="mock"></a>mock</h2><p>此目录下所有的 .js 文件（包括 _ 前缀的）都会被解析为 mock 文件。<br>比如，新建 mock/users.js，内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="string">'/api/users'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>],</span><br><span class="line">&#125;</span><br><span class="line">然后在浏览器里访问 <span class="string">'http://localhost:8000/api/users'</span> 就可以看到 [<span class="string">'a'</span>, <span class="string">'b'</span>] 了。</span><br></pre></td></tr></table></figure>
<h2 id="src"><a href="#src" class="headerlink" title="src"></a>src</h2><p>约定 src 为源码目录，如果不存在 src 目录，则当前目录会被作为源码目录。<br>比如：下面两种目录结构的效果是一致的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ src</span><br><span class="line">  + pages</span><br><span class="line">    - index.js</span><br><span class="line">  + layouts</span><br><span class="line">    - index.js</span><br><span class="line">- .umirc.js</span><br><span class="line">+ pages</span><br><span class="line">  - index.js</span><br><span class="line">+ layouts</span><br><span class="line">  - index.js</span><br><span class="line">- .umirc.js</span><br></pre></td></tr></table></figure>
<h2 id="src-layouts-index-js"><a href="#src-layouts-index-js" class="headerlink" title="src/layouts/index.js"></a>src/layouts/index.js</h2><blockquote>
<p>注：配置式路由下无效。</p>
</blockquote>
<p>全局布局，在路由外面套的一层路由。<br>比如，你的路由是：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; path: '/', component: './pages/index' &#125;,</span><br><span class="line">  &#123; path: '/users', component: './pages/users' &#125;,</span><br><span class="line">]</span><br><span class="line">如果有 layouts/index.js，那么路由就会变为：</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  &#123; path: '/', component: './layouts/index', routes: [</span><br><span class="line">    &#123; path: '/', component: './pages/index' &#125;,</span><br><span class="line">    &#123; path: '/users', component: './pages/users' &#125;,</span><br><span class="line">  ] &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="src-pages"><a href="#src-pages" class="headerlink" title="src/pages"></a>src/pages</h2><p>约定 pages 下所有的 js、jsx、ts 和 tsx 文件即路由。</p>
<blockquote>
<p>注：配置式路由下无效。</p>
</blockquote>
<h2 id="src-pages-404-js"><a href="#src-pages-404-js" class="headerlink" title="src/pages/404.js"></a>src/pages/404.js</h2><p>404 页面。注意开发模式下有内置 umi 提供的 404 提示页面，所以只有显式访问 /404 才能访问到这个页面。</p>
<h2 id="src-pages-document-ejs"><a href="#src-pages-document-ejs" class="headerlink" title="src/pages/document.ejs"></a>src/pages/document.ejs</h2><p>有这个文件时，会覆盖默认的 HTML 模板。<br>模板里需至少包含根节点的 HTML 信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="src-pages-umi"><a href="#src-pages-umi" class="headerlink" title="src/pages/.umi"></a>src/pages/.umi</h2><p>这是 umi dev 时生产的临时目录，默认包含 umi.js 和 router.js，有些插件(dva, babel)也会在这里生成一些其他临时文件。可以在这里做一些验证，但请不要直接在这里修改代码，umi 重启或者 pages 下的文件修改都会重新生成这个文件夹下的文件。</p>
<h2 id="src-pages-umi-production"><a href="#src-pages-umi-production" class="headerlink" title="src/pages/.umi-production"></a>src/pages/.umi-production</h2><p>同 src/pages/.umi，但是是在 umi build 时生成的，umi build 执行完自动删除。</p>
<h2 id="test-js-ts-和-e2e-js-ts"><a href="#test-js-ts-和-e2e-js-ts" class="headerlink" title=".test.(js|ts) 和 .e2e.(js|ts)"></a>.test.(js|ts) 和 .e2e.(js|ts)</h2><p>测试文件，umi test 会查找所有的 .test.js 和 .e2e.js 文件来跑测试。</p>
<h2 id="src-global-js-ts"><a href="#src-global-js-ts" class="headerlink" title="src/global.(js|ts)"></a>src/global.(js|ts)</h2><p>此文件会在入口文件的最前面被自动引入，可以在这里加载补丁，做一些初始化的操作等。</p>
<h2 id="src-global-css-less-sass-scss"><a href="#src-global-css-less-sass-scss" class="headerlink" title="src/global.(css|less|sass|scss)"></a>src/global.(css|less|sass|scss)</h2><p>此文件不走 css modules，且会自动被引入，可以在这里写全局样式，以及做样式覆盖。</p>
<h2 id="src-app-js-ts"><a href="#src-app-js-ts" class="headerlink" title="src/app.(js|ts)"></a>src/app.(js|ts)</h2><p>运行时配置文件，可以在这里扩展运行时的能力，比如修改路由、修改 render 方法等。</p>
<h2 id="umirc-js-ts-和-config-config-js-ts"><a href="#umirc-js-ts-和-config-config-js-ts" class="headerlink" title=".umirc.(js|ts) 和 config/config.(js|ts)"></a>.umirc.(js|ts) 和 config/config.(js|ts)</h2><p>编译时配置文件，二选一，不可共存。</p>
<h2 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h2><p>环境变量配置文件，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CLEAR_CONSOLE=none</span><br><span class="line">BROWSER=none</span><br></pre></td></tr></table></figure>
<h1 id="路由（重点，umi已约定式路由为基础拓展）"><a href="#路由（重点，umi已约定式路由为基础拓展）" class="headerlink" title="路由（重点，umi已约定式路由为基础拓展）"></a>路由（重点，umi已约定式路由为基础拓展）</h1><blockquote>
<p>路由使用可以在 umi-examples/routes 和 umi-examples/routes-via-config 里找到示例代码。<br>umi 会根据 pages 目录自动生成路由配置。</p>
</blockquote>
<h2 id="约定式路由"><a href="#约定式路由" class="headerlink" title="约定式路由"></a>约定式路由</h2><h3 id="基础路由"><a href="#基础路由" class="headerlink" title="基础路由"></a>基础路由</h3><p>假设 pages 目录结构如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ pages/</span><br><span class="line">  + users/</span><br><span class="line">    - index.js</span><br><span class="line">    - list.js</span><br><span class="line">  - index.js</span><br></pre></td></tr></table></figure>
<p>那么，umi 会自动生成路由配置如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; path: '/', component: './pages/index.js' &#125;,</span><br><span class="line">  &#123; path: '/users/', component: './pages/users/index.js' &#125;,</span><br><span class="line">  &#123; path: '/users/list', component: './pages/users/list.js' &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h3><p>umi 里约定，带 $ 前缀的目录或文件为动态路由。</p>
<p>比如以下目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ pages/</span><br><span class="line">  + <span class="variable">$post</span>/</span><br><span class="line">    - index.js</span><br><span class="line">    - comments.js</span><br><span class="line">  + users/</span><br><span class="line">    <span class="variable">$id</span>.js</span><br><span class="line">  - index.js</span><br></pre></td></tr></table></figure>
<p>会生成路由配置如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; path: '/', component: './pages/index.js' &#125;,</span><br><span class="line">  &#123; path: '/users/:id', component: './pages/users/$id.js' &#125;,</span><br><span class="line">  &#123; path: '/:post/', component: './pages/$post/index.js' &#125;,</span><br><span class="line">  &#123; path: '/:post/comments', component: './pages/$post/comments.js' &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="可选的动态路由"><a href="#可选的动态路由" class="headerlink" title="可选的动态路由"></a>可选的动态路由</h3><p>umi 里约定动态路由如果带 $ 后缀，则为可选动态路由。</p>
<p>比如以下结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ pages/</span><br><span class="line">  + users/</span><br><span class="line">    - <span class="variable">$id</span>$.js</span><br><span class="line">  - index.js</span><br></pre></td></tr></table></figure>
<p>会生成路由配置如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; path: '/': component: './pages/index.js' &#125;,</span><br><span class="line">  &#123; path: '/users/:id?': component: './pages/users/$id$.js' &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><p>umi 里约定目录下有 _layout.js 时会生成嵌套路由，以 _layout.js 为该目录的 layout 。</p>
<p>比如以下目录结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ pages/</span><br><span class="line">  + users/</span><br><span class="line">    - _layout.js</span><br><span class="line">    - <span class="variable">$id</span>.js</span><br><span class="line">    - index.js</span><br></pre></td></tr></table></figure>
<p>会生成路由配置如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; path: '/users', component: './pages/users/_layout.js',</span><br><span class="line">    routes: [</span><br><span class="line">     &#123; path: '/users/', component: './pages/users/index.js' &#125;,</span><br><span class="line">     &#123; path: '/users/:id', component: './pages/users/$id.js' &#125;,</span><br><span class="line">   ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="全局-layout"><a href="#全局-layout" class="headerlink" title="全局 layout"></a>全局 layout</h3><p>约定 src/layouts/index.js 为全局路由，返回一个 React 组件，通过 props.children 渲染子组件。</p>
<p>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Header /&gt;</span><br><span class="line">      &#123; props.children &#125;</span><br><span class="line">      &lt;Footer /&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="不同的全局-layout"><a href="#不同的全局-layout" class="headerlink" title="不同的全局 layout"></a>不同的全局 layout</h3><p>你可能需要针对不同路由输出不同的全局 layout，umi 不支持这样的配置，但你仍可以在 layouts/index.js 对 location.path 做区分，渲染不同的 layout 。</p>
<p>比如想要针对 /login 输出简单布局，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (props.location.pathname === <span class="string">'/login'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SimpleLayout</span>&gt;</span>&#123; props.children &#125;<span class="tag">&lt;/<span class="name">SimpleLayout</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Header /&gt;</span><br><span class="line">      &#123; props.children &#125;</span><br><span class="line">      &lt;Footer /&gt;</span><br><span class="line">    &lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="404-路由"><a href="#404-路由" class="headerlink" title="404 路由"></a>404 路由</h3><p>约定 pages/404.js 为 404 页面，需返回 React 组件。</p>
<p>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;I am a customized <span class="number">404</span> page&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：开发模式下，umi 会添加一个默认的 404 页面来辅助开发，但你仍然可通过精确地访问 /404 来验证 404 页面。</p>
</blockquote>
<h3 id="通过注释扩展路由"><a href="#通过注释扩展路由" class="headerlink" title="通过注释扩展路由"></a>通过注释扩展路由</h3><p>约定路由文件的首个注释如果包含 yaml 格式的配置，则会被用于扩展路由。</p>
<p>比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+ pages/</span><br><span class="line">  - index.js</span><br><span class="line">如果 pages/index.js 里包含：</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * title: Index Page</span><br><span class="line"> * Routes:</span><br><span class="line"> *   - ./src/routes/a.js</span><br><span class="line"> *   - ./src/routes/b.js</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<p>则会生成路由配置：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; path: '/', component: './index.js',</span><br><span class="line">    title: 'Index Page',</span><br><span class="line">    Routes: [ './src/routes/a.js', './src/routes/b.js' ],</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="配置式路由"><a href="#配置式路由" class="headerlink" title="配置式路由"></a>配置式路由</h2><p>如果你倾向于使用配置式的路由，可以配置 routes ，此配置项存在时则不会对 src/pages 目录做约定式的解析。（咱们先按约定式路由搞一遍，然后后边再来一套配置式路由的）</p>
<p>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">component</span>: <span class="string">'./a'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/list'</span>, <span class="attr">component</span>: <span class="string">'./b'</span>, <span class="attr">Routes</span>: [<span class="string">'./routes/PrivateRoute.js'</span>] &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">'/users'</span>, <span class="attr">component</span>: <span class="string">'./users/_layout'</span>,</span><br><span class="line">      routes: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">'/users/detail'</span>, <span class="attr">component</span>: <span class="string">'./users/detail'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">'/users/:id'</span>, <span class="attr">component</span>: <span class="string">'./users/id'</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<br>component 是相对于 src/pages 目录的</p>
</blockquote>
<h2 id="权限路由"><a href="#权限路由" class="headerlink" title="权限路由"></a>权限路由</h2><p>umi 的权限路由是通过配置路由的 Routes 属性来实现。约定式的通过 yaml 注释添加，配置式的直接配上即可。</p>
<p>比如有以下配置：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; path: '/', component: './pages/index.js' &#125;,</span><br><span class="line">  &#123; path: '/list', component: './pages/list.js', Routes: ['./routes/PrivateRoute.js'] &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>然后 umi 会用 ./routes/PrivateRoute.js 来渲染 /list。</p>
<p>./routes/PrivateRoute.js 文件示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;PrivateRoute (routes/PrivateRoute.js)&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &#123; props.children &#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="路由动效"><a href="#路由动效" class="headerlink" title="路由动效"></a>路由动效</h2><p>路由动效应该是有多种实现方式，这里举 react-transition-group 的例子。</p>
<p>先安装依赖，</p>
<p>$ yarn add react-transition-group<br>在 layout 组件（layouts/index.js 或者 pages 子目录下的 _layout.js）里在渲染子组件时用 TransitionGroup 和 CSSTransition 包裹一层，并以 location.pathname 为 key，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> withRouter <span class="keyword">from</span> <span class="string">'umi/withRouter'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TransitionGroup, CSSTransition &#125; <span class="keyword">from</span> <span class="string">"react-transition-group"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(</span><br><span class="line">  (&#123; location &#125;) =&gt;</span><br><span class="line">    &lt;TransitionGroup&gt;</span><br><span class="line">      &lt;CSSTransition key=&#123;location.pathname&#125; classNames=<span class="string">"fade"</span> timeout=&#123;<span class="number">300</span>&#125;&gt;</span><br><span class="line">        &#123; children &#125;</span><br><span class="line">      &lt;<span class="regexp">/CSSTransition&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>TransitionGroup&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>上面用到的 fade 样式，可以在 src 下的 global.css 里定义：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.fade-enter</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.fade-enter</span><span class="selector-class">.fade-enter-active</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">250ms</span> ease-in;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="面包屑"><a href="#面包屑" class="headerlink" title="面包屑"></a>面包屑</h2><p>面包屑也是有多种实现方式，这里举 react-router-breadcrumbs-hoc 的例子。</p>
<p>先安装依赖，</p>
<p>$ yarn add react-router-breadcrumbs-hoc<br>然后实现一个 Breakcrumbs.js，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> NavLink <span class="keyword">from</span> <span class="string">'umi/navlink'</span>;</span><br><span class="line"><span class="keyword">import</span> withBreadcrumbs <span class="keyword">from</span> <span class="string">'react-router-breadcrumbs-hoc'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更多配置请移步 https://github.com/icd2k3/react-router-breadcrumbs-hoc</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">breadcrumb</span>: <span class="string">'首页'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">'/list'</span>, <span class="attr">breadcrumb</span>: <span class="string">'List Page'</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withBreadcrumbs(routes)(<span class="function">(<span class="params">&#123; breadcrumbs &#125;</span>) =&gt;</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;breadcrumbs.map(<span class="function">(<span class="params">breadcrumb, index</span>) =&gt;</span> (</span><br><span class="line">      &lt;span key=&#123;breadcrumb.key&#125;&gt;</span><br><span class="line">        &lt;NavLink to=&#123;breadcrumb.props.match.url&#125;&gt;</span><br><span class="line">          &#123;breadcrumb&#125;</span><br><span class="line">        &lt;<span class="regexp">/NavLink&gt;</span></span><br><span class="line"><span class="regexp">        &#123;(index &lt; breadcrumbs.length - 1) &amp;&amp; &lt;i&gt; /</span> &lt;<span class="regexp">/i&gt;&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>span&gt;</span><br><span class="line">    ))&#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">));</span></span><br></pre></td></tr></table></figure>
<p>然后在需要的地方引入此 React 组件即可。</p>
<h2 id="启用-Hash-路由"><a href="#启用-Hash-路由" class="headerlink" title="启用 Hash 路由"></a>启用 Hash 路由</h2><p>umi 默认是用的 Browser History，如果要用 Hash History，需配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">  history: &apos;hash&apos;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Scroll-to-top"><a href="#Scroll-to-top" class="headerlink" title="Scroll to top"></a>Scroll to top</h2><p>在 layout 组件（layouts/index.js 或者 pages 子目录下的 _layout.js）的 componentDidUpdate 里决定是否 scroll to top，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> withRouter <span class="keyword">from</span> <span class="string">'umi/withRouter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Layout</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidUpdate(prevProps) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.props.location !== prevProps.location) &#123;</span><br><span class="line">      <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(Layout);</span><br></pre></td></tr></table></figure>
<h1 id="在页面间跳转"><a href="#在页面间跳转" class="headerlink" title="在页面间跳转"></a>在页面间跳转</h1><p>在 umi 里，页面之间跳转有两种方式：声明式和命令式。</p>
<h2 id="声明式"><a href="#声明式" class="headerlink" title="声明式"></a>声明式</h2><p>基于 umi/link，通常作为 React 组件使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'umi/link'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;Link to=<span class="string">"/list"</span>&gt;Go to list page&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<h2 id="命令式"><a href="#命令式" class="headerlink" title="命令式"></a>命令式</h2><p>基于 umi/router，通常在事件处理中被调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'umi/router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">goToListPage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  router.push(<span class="string">'/list'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更多命令式的跳转方法，详见 api#umi/router。</p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>umi 允许在 .umirc.js 或 config/config.js （二选一，.umirc.js 优先）中进行配置，支持 ES6 语法。</p>
<p>为简化说明，后续文档里只会出现 .umirc.js。</p>
<p>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  base: <span class="string">'/admin/'</span>,</span><br><span class="line">  publicPath: <span class="string">'http://cdn.com/foo'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    [<span class="string">'umi-plugin-react'</span>, &#123;</span><br><span class="line">      dva: <span class="literal">true</span>,</span><br><span class="line">    &#125;],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>具体配置项详见配置。</p>
<h2 id="umirc-local-js"><a href="#umirc-local-js" class="headerlink" title=".umirc.local.js"></a>.umirc.local.js</h2><p>.umirc.local.js 是本地的配置文件，不要提交到 git，所以通常需要配置到 .gitignore。如果存在，会和 .umirc.js 合并后再返回。</p>
<h2 id="UMI-ENV"><a href="#UMI-ENV" class="headerlink" title="UMI_ENV"></a>UMI_ENV</h2><p>可以通过环境变量 UMI_ENV 区分不同环境来指定配置。</p>
<p>举个例子，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .umirc.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .umirc.cloud.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; <span class="attr">b</span>: <span class="string">'cloud'</span>, <span class="attr">c</span>: <span class="string">'cloud'</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .umirc.local.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; <span class="attr">c</span>: <span class="string">'local'</span> &#125;;</span><br><span class="line">不指定 UMI_ENV 时，拿到的配置是：</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">2</span>,</span><br><span class="line">  c: <span class="string">'local'</span>,</span><br><span class="line">&#125;</span><br><span class="line">指定 UMI_ENV=cloud 时，拿到的配置是：</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="string">'cloud'</span>,</span><br><span class="line">  c: <span class="string">'local'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="HTML-模板"><a href="#HTML-模板" class="headerlink" title="HTML 模板"></a>HTML 模板</h1><h2 id="修改默认模板"><a href="#修改默认模板" class="headerlink" title="修改默认模板"></a>修改默认模板</h2><p>新建 src/pages/document.ejs，umi 约定如果这个文件存在，会作为默认模板，内容上需要保证有</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"root"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>比如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Your App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="配置模板"><a href="#配置模板" class="headerlink" title="配置模板"></a>配置模板</h2><p>模板里可通过 context 来获取到 umi 提供的变量，context 包含：</p>
<p>route，路由对象，包含 path、component 等<br>config，用户配置信息<br>publicPath2.1.2+，webpack 的 output.publicPath 配置<br>env，环境变量，值为 development 或 production<br>其他在路由上通过 context 扩展的配置信息<br>模板基于 ejs 渲染，可以参考 <a href="https://github.com/mde/ejs" target="_blank" rel="noopener">https://github.com/mde/ejs</a> 查看具体使用。</p>
<p>比如输出变量，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span> <span class="attr">href</span>=<span class="string">"&lt;%= context.publicPath %&gt;favicon.png"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>比如条件判断，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">context.env</span> === <span class="string">'production'</span>) &#123; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>生产环境<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; <span class="attr">else</span> &#123;%&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>开发环境<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="针对特定页面指定模板"><a href="#针对特定页面指定模板" class="headerlink" title="针对特定页面指定模板"></a>针对特定页面指定模板</h1><p>WARNING</p>
<p>此功能需开启 exportStatic 配置，否则只会输出一个 html 文件。</p>
<p>TIP</p>
<p>优先级是：路由的 document 属性 &gt; src/pages/document.ejs &gt; umi 内置模板</p>
<p>配置路由的 document 属性。</p>
<p>比如约定式路由可通过注释扩展 document 属性，路径从项目根目录开始找，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * document: ./src/documents/404.ejs</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<p>然后这个路由就会以 ./src/documents/404.ejs 为模板输出 HTML。</p>
<h1 id="Mock-数据"><a href="#Mock-数据" class="headerlink" title="Mock 数据"></a>Mock 数据</h1><p>Mock 数据是前端开发过程中必不可少的一环，是分离前后端开发的关键链路。通过预先跟服务器端约定好的接口，模拟请求数据甚至逻辑，能够让前端开发独立自主，不会被服务端的开发所阻塞。</p>
<h2 id="使用-umi-的-mock-功能"><a href="#使用-umi-的-mock-功能" class="headerlink" title="使用 umi 的 mock 功能"></a>使用 umi 的 mock 功能</h2><p>umi 里约定 mock 文件夹下的文件或者 page(s) 文件夹下的 _mock 文件即 mock 文件，文件导出接口定义，支持基于 require 动态分析的实时刷新，支持 ES6 语法，以及友好的出错提示，详情参看 mock-data。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 支持值为 Object 和 Array</span></span><br><span class="line">  <span class="string">'GET /api/users'</span>: &#123; <span class="attr">users</span>: [<span class="number">1</span>, <span class="number">2</span>] &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GET POST 可省略</span></span><br><span class="line">  <span class="string">'/api/users/1'</span>: &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支持自定义函数，API 参考 express@4</span></span><br><span class="line">  <span class="string">'POST /api/users/create'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; res.end(<span class="string">'OK'</span>); &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>当客户端（浏览器）发送请求，如：GET /api/users，那么本地启动的 umi dev 会跟此配置文件匹配请求路径以及方法，如果匹配到了，就会将请求通过配置处理，就可以像样例一样，你可以直接返回数据，也可以通过函数处理以及重定向到另一个服务器。</p>
<p>比如定义如下映射规则：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'GET /api/currentUser'</span>: &#123;</span><br><span class="line">  name: <span class="string">'momo.zxy'</span>,</span><br><span class="line">  avatar: imgMap.user,</span><br><span class="line">  userid: <span class="string">'00000001'</span>,</span><br><span class="line">  notifyCount: <span class="number">12</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>访问的本地 /api/users 接口：</p>
<p>请求头</p>
<p>返回的数据</p>
<h2 id="引入-Mock-js"><a href="#引入-Mock-js" class="headerlink" title="引入 Mock.js"></a>引入 Mock.js</h2><p>Mock.js 是常用的辅助生成模拟数据的第三方库，当然你可以用你喜欢的任意库来结合 roadhog 构建数据模拟功能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mockjs <span class="keyword">from</span> <span class="string">'mockjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 使用 mockjs 等三方库</span></span><br><span class="line">  <span class="string">'GET /api/tags'</span>: mockjs.mock(&#123;</span><br><span class="line">    <span class="string">'list|100'</span>: [&#123; <span class="attr">name</span>: <span class="string">'@city'</span>, <span class="string">'value|1-100'</span>: <span class="number">50</span>, <span class="string">'type|0-2'</span>: <span class="number">1</span> &#125;],</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="添加跨域请求头"><a href="#添加跨域请求头" class="headerlink" title="添加跨域请求头"></a>添加跨域请求头</h2><p>设置 response 的请求头即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'POST /api/users/create'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>);</span><br><span class="line">  ...</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="合理的拆分你的-mock-文件"><a href="#合理的拆分你的-mock-文件" class="headerlink" title="合理的拆分你的 mock 文件"></a>合理的拆分你的 mock 文件</h2><p>对于整个系统来说，请求接口是复杂并且繁多的，为了处理大量模拟请求的场景，我们通常把每一个数据模型抽象成一个文件，统一放在 mock 的文件夹中，然后他们会自动被引入。</p>
<h2 id="如何模拟延迟"><a href="#如何模拟延迟" class="headerlink" title="如何模拟延迟"></a>如何模拟延迟</h2><p>为了更加真实的模拟网络数据请求，往往需要模拟网络延迟时间。</p>
<h2 id="手动添加-setTimeout-模拟延迟"><a href="#手动添加-setTimeout-模拟延迟" class="headerlink" title="手动添加 setTimeout 模拟延迟"></a>手动添加 setTimeout 模拟延迟</h2><p>你可以在重写请求的代理方法，在其中添加模拟延迟的处理，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'POST /api/forms'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">'Ok'</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="使用插件模拟延迟"><a href="#使用插件模拟延迟" class="headerlink" title="使用插件模拟延迟"></a>使用插件模拟延迟</h2><p>上面的方法虽然简便，但是当你需要添加所有的请求延迟的时候，可能就麻烦了，不过可以通过第三方插件来简化这个问题，如：roadhog-api-doc#delay。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; delay &#125; <span class="keyword">from</span> <span class="string">'roadhog-api-doc'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = &#123;</span><br><span class="line">  <span class="string">'GET /api/project/notice'</span>: getNotice,</span><br><span class="line">  <span class="string">'GET /api/activities'</span>: getActivities,</span><br><span class="line">  <span class="string">'GET /api/rule'</span>: getRule,</span><br><span class="line">  <span class="string">'GET /api/tags'</span>: mockjs.mock(&#123;</span><br><span class="line">    <span class="string">'list|100'</span>: [&#123; <span class="attr">name</span>: <span class="string">'@city'</span>, <span class="string">'value|1-100'</span>: <span class="number">50</span>, <span class="string">'type|0-2'</span>: <span class="number">1</span> &#125;]</span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="string">'GET /api/fake_list'</span>: getFakeList,</span><br><span class="line">  <span class="string">'GET /api/fake_chart_data'</span>: getFakeChartData,</span><br><span class="line">  <span class="string">'GET /api/profile/basic'</span>: getProfileBasicData,</span><br><span class="line">  <span class="string">'GET /api/profile/advanced'</span>: getProfileAdvancedData,</span><br><span class="line">  <span class="string">'POST /api/register'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(&#123; <span class="attr">status</span>: <span class="string">'ok'</span> &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'GET /api/notices'</span>: getNotices,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>// 调用 delay 函数，统一处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> delay(proxy, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="动态-Mock-数据"><a href="#动态-Mock-数据" class="headerlink" title="动态 Mock 数据"></a>动态 Mock 数据</h2><p>如果你需要动态生成 Mock 数据，你应该通过函数进行处理，</p>
<p>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态的</span></span><br><span class="line"><span class="string">'/api/random'</span>: Mock.mock(&#123;</span><br><span class="line">  <span class="comment">// 只随机一次</span></span><br><span class="line">  <span class="string">'number|1-100'</span>: <span class="number">100</span>,</span><br><span class="line">&#125;),</span><br><span class="line"><span class="comment">// 动态的</span></span><br><span class="line"><span class="string">'/api/random'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(Mock.mock(&#123;</span><br><span class="line">    <span class="comment">// 每次请求均产生随机值</span></span><br><span class="line">    <span class="string">'number|1-100'</span>: <span class="number">100</span>,</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="联调"><a href="#联调" class="headerlink" title="联调"></a>联调</h2><p>当本地开发完毕之后，如果服务器的接口满足之前的约定，那么你只需要不开本地代理或者重定向代理到目标服务器就可以访问真实的服务端数据，非常方便。</p>
<h1 id="Use-umi-with-dva-重点"><a href="#Use-umi-with-dva-重点" class="headerlink" title="Use umi with dva(重点)"></a>Use umi with dva(重点)</h1><p>自&gt;= umi@2起，dva的整合可以直接通过 umi-plugin-react 来配置。</p>
<h2 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h2><p>按目录约定注册 model，无需手动 app.model<br>文件名即 namespace，可以省去 model 导出的 namespace key<br>无需手写 router.js，交给 umi 处理，支持 model 和 component 的按需加载<br>内置 query-string 处理，无需再手动解码和编码<br>内置 dva-loading 和 dva-immer，其中 dva-immer 需通过配置开启<br>开箱即用，无需安装额外依赖，比如 dva、dva-loading、dva-immer、path-to-regexp、object-assign、react、react-dom 等</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>用 yarn 安装依赖，</p>
<p>$ yarn add umi-plugin-react<br>如果你用 npm，执行 npm install –save umi-plugin-react。</p>
<p>然后在 .umirc.js 里配置插件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">'umi-plugin-react'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        dva: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>推荐开启 dva-immer 以简化 reducer 编写，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">'umi-plugin-react'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        dva: &#123;</span><br><span class="line">          immer: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="model-注册"><a href="#model-注册" class="headerlink" title="model 注册"></a>model 注册</h2><p>model 分两类，一是全局 model，二是页面 model。全局 model 存于 /src/models/ 目录，所有页面都可引用；页面 model 不能被其他页面所引用。</p>
<p>规则如下：</p>
<blockquote>
<p>src/models/<strong>/*.js 为 global model<br>src/pages/</strong>/models/<strong>/*.js 为 page model<br>global model 全量载入，page model 在 production 时按需载入，在 development 时全量载入<br>page model 为 page js 所在路径下 models/</strong>/<em>.js 的文件<br>page model 会向上查找，比如 page js 为 pages/a/b.js，他的 page model 为 pages/a/b/models/**/</em>.js + pages/a/models/<strong>/*.js，依次类推<br>约定 model.js 为单文件 model，解决只有一个 model 时不需要建 models 目录的问题，有 model.js 则不去找 models/</strong>/*.js<br>举个例子，</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ src</span><br><span class="line">  + models</span><br><span class="line">    - g.js</span><br><span class="line">  + pages</span><br><span class="line">    + a</span><br><span class="line">      + models</span><br><span class="line">        - a.js</span><br><span class="line">        - b.js</span><br><span class="line">        + ss</span><br><span class="line">          - s.js</span><br><span class="line">      - page.js</span><br><span class="line">    + c</span><br><span class="line">      - model.js</span><br><span class="line">      + d</span><br><span class="line">        + models</span><br><span class="line">          - d.js</span><br><span class="line">        - page.js</span><br><span class="line">      - page.js</span><br></pre></td></tr></table></figure>
<p>如上目录：</p>
<blockquote>
<p>global model 为 src/models/g.js<br>/a 的 page model 为 src/pages/a/models/{a,b,ss/s}.js<br>/c 的 page model 为 src/pages/c/model.js<br>/c/d 的 page model 为 src/pages/c/model.js, src/pages/c/d/models/d.js</p>
</blockquote>
<h2 id="配置及插件"><a href="#配置及插件" class="headerlink" title="配置及插件"></a>配置及插件</h2><p>之前在 src/dva.js 下进行配置的方式已 deprecated，下个大版本会移除支持。</p>
<p>在 src 目录下新建 app.js，内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dva = &#123;</span><br><span class="line">  config: &#123;</span><br><span class="line">    onError(e) &#123;</span><br><span class="line">      e.preventDefault();</span><br><span class="line">      <span class="built_in">console</span>.error(e.message);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'dva-logger'</span>)(),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="url-变化了，但页面组件不刷新，是什么原因？"><a href="#url-变化了，但页面组件不刷新，是什么原因？" class="headerlink" title="url 变化了，但页面组件不刷新，是什么原因？"></a>url 变化了，但页面组件不刷新，是什么原因？</h3><p>layouts/index.js 里如果用了 connect 传数据，需要用 umi/withRouter 高阶一下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> withRouter <span class="keyword">from</span> <span class="string">'umi/withRouter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(connect(mapStateToProps)(LayoutComponent));</span><br></pre></td></tr></table></figure>
<h3 id="如何访问到-store-或-dispatch-方法？"><a href="#如何访问到-store-或-dispatch-方法？" class="headerlink" title="如何访问到 store 或 dispatch 方法？"></a>如何访问到 store 或 dispatch 方法？</h3><p>window.g_app._store<br>window.g_app._store.dispatch</p>
<h3 id="如何禁用包括-component-和-models-的按需加载？"><a href="#如何禁用包括-component-和-models-的按需加载？" class="headerlink" title="如何禁用包括 component 和 models 的按需加载？"></a>如何禁用包括 component 和 models 的按需加载？</h3><p>在 .umirc.js 里配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">'umi-plugin-react'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        dva: &#123;</span><br><span class="line">          dynamicImport: <span class="literal">undefined</span> <span class="comment">// 配置在dva里</span></span><br><span class="line">        &#125;,</span><br><span class="line">        dynamicImport: <span class="literal">undefined</span>   <span class="comment">// 或者直接写在react插件的根配置，写在这里也会被继承到上面的dva配置里</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="全局-layout-使用-connect-后路由切换后没有刷新？"><a href="#全局-layout-使用-connect-后路由切换后没有刷新？" class="headerlink" title="全局 layout 使用 connect 后路由切换后没有刷新？"></a>全局 layout 使用 connect 后路由切换后没有刷新？</h3><p>需用 withRouter 包一下导出的 react 组件，注意顺序。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> withRouter <span class="keyword">from</span> <span class="string">'umi/withRouter'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(connect()(Layout));</span><br></pre></td></tr></table></figure>
<h1 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h1><p>出于性能的考虑，我们会对模块和组件进行按需加载。</p>
<h2 id="按需加载组件"><a href="#按需加载组件" class="headerlink" title="按需加载组件"></a>按需加载组件</h2><p>通过 umi/dynamic 接口实现，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dynamic <span class="keyword">from</span> <span class="string">'umi/dynamic'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> delay = <span class="function">(<span class="params">timeout</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> setTimeout(resolve, timeout));</span><br><span class="line"><span class="keyword">const</span> App = dynamic(&#123;</span><br><span class="line">  loader: <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> delay(<span class="comment">/* 1s */</span><span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;I will render after <span class="number">1</span>s&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure>
<h2 id="按需加载模块"><a href="#按需加载模块" class="headerlink" title="按需加载模块"></a>按需加载模块</h2><p>通过 import() 实现，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>(<span class="string">'g2'</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// do something with g2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="运行时配置"><a href="#运行时配置" class="headerlink" title="运行时配置"></a>运行时配置</h1><h2 id="为什么有运行时配置？"><a href="#为什么有运行时配置？" class="headerlink" title="为什么有运行时配置？"></a>为什么有运行时配置？</h2><p>我们通过 .umirc.js 做编译时的配置，这能覆盖大量场景，但有一些却是编译时很难触及的。</p>
<p>比如：</p>
<p>在出错时显示个 message 提示用户<br>在加载和路由切换时显示个 loading<br>页面载入完成时请求后端，根据响应动态修改路由<br>这些在编译时就很难处理，或者不能处理了。</p>
<h2 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h2><p>umi 约定 src 目录下的 app.js 为运行时的配置文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ src</span><br><span class="line">  - app.js      <span class="comment"># 运行时配置文件</span></span><br><span class="line">- package.json</span><br></pre></td></tr></table></figure>
<h2 id="配置列表"><a href="#配置列表" class="headerlink" title="配置列表"></a>配置列表</h2><h3 id="patchRoutes"><a href="#patchRoutes" class="headerlink" title="patchRoutes"></a>patchRoutes</h3><p>用于运行时修改路由。</p>
<blockquote>
<p>参数：<br>routes: Array，路由配置<br>e.g. 添加一个 /foo 的路由，</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> patchRoutes(routes) &#123;</span><br><span class="line">  routes[0].unshift(&#123;</span><br><span class="line">    path: <span class="string">'/foo'</span>,</span><br><span class="line">    component: require(<span class="string">'./routes/foo'</span>).default,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可能的场景：<br>和 render 配合使用，请求服务端根据响应动态更新路由<br>修改全部路由，加上某个前缀<br>…<br>注：</p>
<p>同样适用约定式路由<br>直接修改 routes 就好，不要返回新的路由对象</p>
<h3 id="render"><a href="#render" class="headerlink" title="render"></a>render</h3><p>用于改写把整个应用 render 到 dom 树里的方法。</p>
<p>参数：<br>oldRender， Function，原始 render 方法，需至少被调用一次<br>e.g. 延迟 1s 渲染应用，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">oldRender</span>) </span>&#123;</span><br><span class="line">  setTimeout(oldRender, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可能的场景：渲染应用之前做权限校验，不通过则跳转到登录页</p>
<h3 id="onRouteChange"><a href="#onRouteChange" class="headerlink" title="onRouteChange"></a>onRouteChange</h3><p>用于在初始加载和路由切换时做一些事情。</p>
<blockquote>
<p>参数：<br>Object<br>location：Object, history 提供的 location 对象<br>routes: Array, 路由配置<br>action: PUSH|POP|REPLACE|undefined，初次加载时为 undefined<br>e.g.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">onRouteChange</span>(<span class="params">&#123; location, routes, action &#125;</span>) </span>&#123;</span><br><span class="line">  bacon(location.pathname);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可能的场景：埋点统计<br>注：初次加载时也会执行，但 action 为 undefined</p>
</blockquote>
<h3 id="rootContainer"><a href="#rootContainer" class="headerlink" title="rootContainer"></a>rootContainer</h3><p>用于封装 root container，可以取一部分，或者外面套一层，等等。</p>
<blockquote>
<p>参数：container，ReactComponent，React 应用最上层的根组件 e.g.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">rootContainer</span>(<span class="params">container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> DvaContainer = <span class="built_in">require</span>(<span class="string">'@tmp/DvaContainer'</span>).default;</span><br><span class="line">  <span class="keyword">return</span> React.createElement(DvaContainer, <span class="literal">null</span>, container);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>可能的场景：dva、intl 等需要在外层有个 Provider 的场景</p>
</blockquote>
<h3 id="modifyRouteProps"><a href="#modifyRouteProps" class="headerlink" title="modifyRouteProps"></a>modifyRouteProps</h3><p>修改传给路由组件的 props。</p>
<blockquote>
<p>参数：<br>props，Object，原始 props<br>Object<br>route，Object，当前路由配置<br>e.g.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">modifyRouteProps</span>(<span class="params">props, &#123; route &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...props, <span class="attr">foo</span>: <span class="string">'bar'</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：需返回新的 props</p>
</blockquote>
<h1 id="区块（区块开发就不赘述了，比较高级的使用方法）"><a href="#区块（区块开发就不赘述了，比较高级的使用方法）" class="headerlink" title="区块（区块开发就不赘述了，比较高级的使用方法）"></a>区块（区块开发就不赘述了，比较高级的使用方法）</h1><p>在 umi 中，区块是指页面级别的可复用的代码。umi 定义了一个区块的规范，你可以通过 umi 能够快速简单的在你的项目中添加区块，用于快速的开始一个页面的开发。</p>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="默认方案"><a href="#默认方案" class="headerlink" title="默认方案"></a>默认方案</h2><p>umi@2 默认对新手友好，所以默认不做按需加载处理，umi build 后输出 index.html、umi.js 和 umi.css 三个文件。</p>
<h2 id="不输出-html-文件"><a href="#不输出-html-文件" class="headerlink" title="不输出 html 文件"></a>不输出 html 文件</h2><p>某些场景 html 文件交给后端输出，前端构建并不需要输出 html 文件，可配置环境变量 HTML=none 实现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ HTML=none umi build</span><br></pre></td></tr></table></figure>
<h2 id="部署-html-到非根目录"><a href="#部署-html-到非根目录" class="headerlink" title="部署 html 到非根目录"></a>部署 html 到非根目录</h2><p>经常有同学问这个问题：</p>
<p>为什么我本地开发是好的，部署后就没反应了，而且没有报错？</p>
<p>没有报错！ 这是应用部署在非根路径的典型现象。为啥会有这个问题？因为路由没有匹配上，比如你把应用部署在 /xxx/ 下，然后访问 /xxx/hello，而代码里匹配的是 /hello，那就匹配不上了，而又没有定义 fallback 的路由，比如 404，那就会显示空白页。</p>
<p>怎么解决？</p>
<p>可通过配置 base 解决。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  base: <span class="string">'/path/to/your/app/root'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="使用-hashHistory"><a href="#使用-hashHistory" class="headerlink" title="使用 hashHistory"></a>使用 hashHistory</h2><p>可通过配置 history 为 hash 为解决。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  history: <span class="string">'hash'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="按需加载-1"><a href="#按需加载-1" class="headerlink" title="按需加载"></a>按需加载</h2><p>要实现按需加载，需装载 umi-plugin-react 插件并配置 dynamicImport。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    [<span class="string">'umi-plugin-react'</span>, &#123;</span><br><span class="line">      dynamicImport: <span class="literal">true</span>,</span><br><span class="line">    &#125;],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参数详见：umi-plugin-react#dynamicImport。</p>
</blockquote>
<h2 id="静态资源在非根目录或-cdn"><a href="#静态资源在非根目录或-cdn" class="headerlink" title="静态资源在非根目录或 cdn"></a>静态资源在非根目录或 cdn</h2><p>这时，就需要配置 publicPath。至于 publicPath 是啥？具体看 webpack 文档，把他指向静态资源（js、css、图片、字体等）所在的路径。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  publicPath: <span class="string">"http://yourcdn/path/to/static/"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用-runtime-的-publicPath"><a href="#使用-runtime-的-publicPath" class="headerlink" title="使用 runtime 的 publicPath"></a>使用 runtime 的 publicPath</h2><p>对于需要在 html 里管理 publicPath 的场景，比如在 html 里判断环境做不同的输出，可通过配置 runtimePublicPath 为解决。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  runtimePublicPath: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后在 html 里输出：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.publicPath = <span class="xml"><span class="tag">&lt;<span class="name">%=</span> <span class="attr">YOUR</span> <span class="attr">PUBLIC_PATH</span> %&gt;</span></span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="静态化"><a href="#静态化" class="headerlink" title="静态化"></a>静态化</h2><p>在一些场景中，无法做服务端的 html fallback，即让每个路由都输出 index.html 的内容，那么就要做静态化。</p>
<p>比如上面的例子，我们在 .umirc.js 里配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  exportStatic: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后执行 umi build，会为每个路由输出一个 html 文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./dist</span><br><span class="line">├── index.html</span><br><span class="line">├── list</span><br><span class="line">│   └── index.html</span><br><span class="line">└── static</span><br><span class="line">    ├── pages__index.5c0f5f51.async.js</span><br><span class="line">    ├── pages__list.f940b099.async.js</span><br><span class="line">    ├── umi.2eaebd79.js</span><br><span class="line">    └── umi.f4cb51da.css</span><br></pre></td></tr></table></figure>
<p>注意：静态化暂不支持有变量路由的场景。</p>
<h2 id="HTML-后缀"><a href="#HTML-后缀" class="headerlink" title="HTML 后缀"></a>HTML 后缀</h2><p>有些静态化的场景里，是不会自动读索引文件的，比如支付宝的容器环境，那么就不能生成这种 html 文件，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── index.html</span><br><span class="line">├── list</span><br><span class="line">│   └── index.html</span><br><span class="line">而是生成，</span><br><span class="line"></span><br><span class="line">├── index.html</span><br><span class="line">└── list.html</span><br></pre></td></tr></table></figure>
<p>配置方式是在 .umirc.js 里，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  exportStatic: &#123;</span><br><span class="line">    htmlSuffix: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>umi build 会生成，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./dist</span><br><span class="line">├── index.html</span><br><span class="line">├── list.html</span><br><span class="line">└── static</span><br><span class="line">    ├── pages__index.5c0f5f51.async.js</span><br><span class="line">    ├── pages__list.f940b099.async.js</span><br><span class="line">    ├── umi.2924fdb7.js</span><br><span class="line">    └── umi.cfe3ffab.css</span><br></pre></td></tr></table></figure>
<h2 id="静态化后输出到任意路径"><a href="#静态化后输出到任意路径" class="headerlink" title="静态化后输出到任意路径"></a>静态化后输出到任意路径</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  exportStatic: &#123;</span><br><span class="line">    htmlSuffix: <span class="literal">true</span>,</span><br><span class="line">    dynamicRoot: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="实战-写一个登陆及管理后台menu-demo"><a href="#实战-写一个登陆及管理后台menu-demo" class="headerlink" title="实战-写一个登陆及管理后台menu demo"></a>实战-写一个登陆及管理后台menu demo</h1><h2 id="目录-1"><a href="#目录-1" class="headerlink" title="目录"></a>目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ mock</span><br><span class="line">  - index.js mock数据</span><br><span class="line">+ src</span><br><span class="line">  + pages</span><br><span class="line">    + index</span><br><span class="line">      - index.js 根路由 即 登陆页</span><br><span class="line">      - index.css</span><br><span class="line">      - model.js</span><br><span class="line">      - service.js</span><br><span class="line">    + dashboard</span><br><span class="line">      - index.js 登陆后首页</span><br><span class="line">+ utils</span><br><span class="line">  - request.js 定义请求对象</span><br></pre></td></tr></table></figure>
<h2 id="首先定义utils下的request请求对象"><a href="#首先定义utils下的request请求对象" class="headerlink" title="首先定义utils下的request请求对象"></a>首先定义utils下的request请求对象</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dva 的fetch 相对底层一些，要自己去扩展很多方法</span></span><br><span class="line"><span class="keyword">import</span> fetch <span class="keyword">from</span> <span class="string">'dva/fetch'</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'umi/router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>; <span class="comment">// 使用antd弹窗</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseJSON</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> response.json(); <span class="comment">// 对于res的解析必须调这个方法 dva 里的 虽然有点奇怪</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkStatus</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (response.status === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(response.status === <span class="number">303</span>)&#123;</span><br><span class="line">    router.replace(<span class="string">'/'</span>); <span class="comment">// cookie失效跳回登录页</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    response.json().then(message.error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于query的format</span></span><br><span class="line"><span class="keyword">const</span> parseQuery = <span class="function">(<span class="params">obj</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> str = <span class="string">''</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">typeof</span> obj[key] !== <span class="string">'string'</span> ? <span class="built_in">JSON</span>.stringify(obj[key]) : obj[key]</span><br><span class="line">    str += <span class="string">'&amp;'</span> + key + <span class="string">'='</span> + value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> str.substr(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Requests a URL, returning a promise.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* @param  &#123;string&#125; url       The URL we want to request</span></span><br><span class="line"><span class="comment">* @param  &#123;object&#125; [options] The options we want to pass to "fetch"</span></span><br><span class="line"><span class="comment">* @return &#123;object&#125;           An object containing either "data" or "err"</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> request = <span class="function">(<span class="params">url, method = <span class="string">'get'</span>, data = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    method,   <span class="comment">// HTTP请求方法，默认为GET</span></span><br><span class="line">    headers:&#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    credentials: <span class="string">'include'</span> </span><br><span class="line">    <span class="comment">// 是否携带cookie，默认为omit,不携带; same-origi,同源携带; include,同源跨域都携带</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'get'</span>) &#123;</span><br><span class="line">    url += <span class="string">'&amp;'</span> + parseQuery(data)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    options.body = <span class="built_in">JSON</span>.stringify(data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fetch(url, options)</span><br><span class="line">  .then(checkStatus)</span><br><span class="line">  .then(parseJSON)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> (data))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> (&#123; err &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">get</span>: (url, data) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> request(url, <span class="string">'get'</span>, data);</span><br><span class="line">  &#125;,</span><br><span class="line">  post: <span class="function">(<span class="params">url, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(url, <span class="string">'post'</span>, data);</span><br><span class="line">  &#125;,</span><br><span class="line">  put: <span class="function">(<span class="params">url, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(url, <span class="string">'put'</span>, data);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">delete</span>: <span class="function">(<span class="params">url, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> request(url, <span class="string">'delete'</span>, data);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="在service下export出在model中调用的api-func"><a href="#在service下export出在model中调用的api-func" class="headerlink" title="在service下export出在model中调用的api func"></a>在service下export出在model中调用的api func</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">'@/utils/request'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span> (<span class="params">user = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request.post(<span class="string">'/login'</span>, user);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="定义model对象"><a href="#定义model对象" class="headerlink" title="定义model对象"></a>定义model对象</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> service <span class="keyword">from</span> <span class="string">'./service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  namespace: <span class="string">'user'</span>, <span class="comment">// 定义命名空间 调用时要指定命名空间</span></span><br><span class="line"></span><br><span class="line">  state: &#123; <span class="comment">// 数据存储</span></span><br><span class="line">    user: &#123;&#125;,  <span class="comment">//reducers中接收数据</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  subscriptions: &#123; <span class="comment">// 暂时没搞懂是干啥的</span></span><br><span class="line">    setup(&#123; dispatch, history &#125;) &#123;  <span class="comment">// eslint-disable-line</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  effects: &#123; <span class="comment">// actions</span></span><br><span class="line">    <span class="comment">// 是个promise 因为集成了redux-saga</span></span><br><span class="line">    * login(&#123; <span class="attr">payload</span>: &#123; user, cb = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125; &#125;&#125;, &#123; call, put &#125;) &#123; <span class="comment">// * 声明是个异步func</span></span><br><span class="line">      <span class="comment">// yield 将等待异步方法返回结果 类似 await</span></span><br><span class="line">      <span class="comment">// call是dva标准用法用来调用api，第一个参数是你的api func，第二个参数是你传入api func 的参数</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">yield</span> call(service.login, user);<span class="comment">// 如果使用  &#123;参数&#125;  ，则是一个对象</span></span><br><span class="line">      <span class="comment">//把请求的数据保存起来</span></span><br><span class="line">      <span class="comment">//数据更新会带动页面重新渲染</span></span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'setUser'</span>,  <span class="comment">//reducers中的方法名</span></span><br><span class="line">        payload: &#123;</span><br><span class="line">          user: result,  <span class="comment">//网络返回的要保留的数据</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    <span class="comment">// 注意！！！effects中的方法名不能与reducers中的方法名重复，否则会死循环</span></span><br><span class="line">    setUser(state, &#123; <span class="attr">payload</span>: &#123; user &#125; &#125;) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state, </span><br><span class="line">        user,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="mock-index-js加些mock数据"><a href="#mock-index-js加些mock数据" class="headerlink" title="mock/index.js加些mock数据"></a>mock/index.js加些mock数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 支持值为 Object 和 Array</span></span><br><span class="line">  <span class="string">'POST /login'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; account, password &#125; = req.body;</span><br><span class="line">    <span class="keyword">if</span> (account === <span class="string">'umi'</span> &amp;&amp; password === <span class="string">'1234'</span>) &#123;</span><br><span class="line">      res.status(<span class="number">200</span>).send(&#123;</span><br><span class="line">        account: <span class="string">'umi'</span>,</span><br><span class="line">        name: <span class="string">'乌米'</span>,</span><br><span class="line">        role: <span class="string">'超级管理员'</span>,</span><br><span class="line">        permissions: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.status(<span class="number">403</span>).json(<span class="string">'账号或密码错误'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="login页面（antd）-，-接口调用及路由跳转"><a href="#login页面（antd）-，-接口调用及路由跳转" class="headerlink" title="login页面（antd） ， 接口调用及路由跳转"></a>login页面（antd） ， 接口调用及路由跳转</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'dva'</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'umi/router'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Input, Icon, Checkbox, Button &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'./index.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> Login = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  handleSubmit = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        <span class="comment">// actions 调用方式 命名空间/action名字</span></span><br><span class="line">        <span class="comment">// 是个promise 因为集成了redux-saga</span></span><br><span class="line">        <span class="keyword">this</span>.props.dispatch(&#123;</span><br><span class="line">          type: <span class="string">'user/login'</span>,</span><br><span class="line">          payload: &#123;</span><br><span class="line">            user: &#123;</span><br><span class="line">              account: values.account,</span><br><span class="line">              password: values.password,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (values.remember) &#123;</span><br><span class="line">            <span class="built_in">window</span>.localStorage.setItem(<span class="string">'account'</span>, values.account);</span><br><span class="line">            <span class="built_in">window</span>.localStorage.setItem(<span class="string">'password'</span>, values.password);</span><br><span class="line">          &#125;</span><br><span class="line">          router.push(<span class="string">'/dashboard'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=&#123;style.loginPanel&#125;&gt;</span><br><span class="line">        &lt;div className=&#123;style.loginForm&#125;&gt;</span><br><span class="line">          &lt;Form onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">            &lt;Form.Item&gt;</span><br><span class="line">              &#123;getFieldDecorator(<span class="string">'account'</span>, &#123;</span><br><span class="line">                rules: [&#123; <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">message</span>: <span class="string">'Please input your username!'</span> &#125;],</span><br><span class="line">              &#125;)(</span><br><span class="line">                &lt;Input</span><br><span class="line">                  prefix=&#123;&lt;Icon type=<span class="string">"user"</span> style=&#123;&#123; <span class="attr">color</span>: <span class="string">'rgba(0,0,0,.25)'</span> &#125;&#125; /&gt;&#125;</span><br><span class="line">                  placeholder=<span class="string">"Username"</span></span><br><span class="line">                /&gt;,</span><br><span class="line">              )&#125;</span><br><span class="line">            &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &#123;getFieldDecorator('password', &#123;</span></span><br><span class="line"><span class="regexp">                rules: [&#123; required: true, message: 'Please input your Password!' &#125;],</span></span><br><span class="line"><span class="regexp">              &#125;)(</span></span><br><span class="line"><span class="regexp">                &lt;Input</span></span><br><span class="line"><span class="regexp">                  prefix=&#123;&lt;Icon type="lock" style=&#123;&#123; color: 'rgba(0,0,0,.25)' &#125;&#125; /</span>&gt;&#125;</span><br><span class="line">                  type=<span class="string">"password"</span></span><br><span class="line">                  placeholder=<span class="string">"Password"</span></span><br><span class="line">                /&gt;,</span><br><span class="line">              )&#125;</span><br><span class="line">            &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &#123;getFieldDecorator('remember', &#123;</span></span><br><span class="line"><span class="regexp">                valuePropName: 'checked',</span></span><br><span class="line"><span class="regexp">                initialValue: true,</span></span><br><span class="line"><span class="regexp">              &#125;)(&lt;Checkbox className=&#123;style.remember&#125;&gt;Remember me&lt;/</span>Checkbox&gt;)&#125;</span><br><span class="line">              &lt;Button type=<span class="string">"primary"</span> htmlType=<span class="string">"submit"</span> className=<span class="string">"login-form-button"</span>&gt;</span><br><span class="line">                Log <span class="keyword">in</span></span><br><span class="line">              &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Form.Item&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">Login = Form.create(&#123; name: 'normal_login' &#125;)(Login); /</span><span class="regexp">/ antd form 使用方法</span></span><br><span class="line"><span class="regexp">export default  connect()(Login);</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 将actions connect进来 不需要再像react中一样手动加actions</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 这里只需要手动connect mapStatusToProps</span></span><br></pre></td></tr></table></figure>

      
      
        <div class="page-reward">
          <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang">赏</a></p>
          <div class="hide_box"></div>
          <div class="shang_box">
            <a class="shang_close" href="javascript:void(0)" onclick="dashangToggle()">×</a>
            <div class="shang_tit">
              <p>纯属好玩</p>
            </div>
            <div class="shang_payimg">
              <img src="/img/alipayimg.jpg" alt="扫码支持" title="扫一扫">
            </div>
              <div class="pay_explain">扫码打赏，你说多少就多少</div>
            <div class="shang_payselect">
              
                <div class="pay_item checked" data-id="alipay">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/alipay.png" alt="支付宝"></span>
                </div>
              
              
                <div class="pay_item" data-id="wechat">
                  <span class="radiobox"></span>
                  <span class="pay_logo"><img src="/img/weixin.png" alt="微信"></span>
                </div>
              
            </div>
            <div class="shang_info">
              <p>打开<span id="shang_pay_txt">支付宝</span>扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
        <script type="text/javascript">
          $(".pay_item").click(function(){
            $(this).addClass('checked').siblings('.pay_item').removeClass('checked');
            var dataid=$(this).attr('data-id');
            $(".shang_payimg img").attr("src","/img/"+dataid+"img.jpg");
            $("#shang_pay_txt").text(dataid=="alipay"?"支付宝":"微信");
          });
          function dashangToggle(){
            
            $(".hide_box").fadeToggle();
            $(".shang_box").fadeToggle();
          }
        </script>
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2019/05/09/umi实战笔记/">umi实战笔记</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 GapGao 的个人博客">GapGao</a></p>
        <p><span>发布时间:</span>2019年05月09日 - 21时42分</p>
        <p><span>最后更新:</span>2024年01月04日 - 16时04分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2019/05/09/umi实战笔记/" title="umi实战笔记">https://gapgao.github.io/2019/05/09/umi实战笔记/</a>
            <span class="copy-path" data-clipboard-text="原文: https://gapgao.github.io/2019/05/09/umi实战笔记/　　作者: GapGao" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target="_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2019/06/01/vConsole调试console/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          vConsole调试console
        
      </div>
    </a>
  
  
    <a href="/2019/04/27/学习计划/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">学习计划</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#介绍"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#特性"><span class="toc-number">2.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装"><span class="toc-number">3.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#项目搭建"><span class="toc-number">4.</span> <span class="toc-text">项目搭建</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#文件目录介绍"><span class="toc-number">5.</span> <span class="toc-text">文件目录介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#目录"><span class="toc-number">5.1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES6-语法"><span class="toc-number">5.2.</span> <span class="toc-text">ES6 语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dist"><span class="toc-number">5.3.</span> <span class="toc-text">dist</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mock"><span class="toc-number">5.4.</span> <span class="toc-text">mock</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src"><span class="toc-number">5.5.</span> <span class="toc-text">src</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-layouts-index-js"><span class="toc-number">5.6.</span> <span class="toc-text">src/layouts/index.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-pages"><span class="toc-number">5.7.</span> <span class="toc-text">src/pages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-pages-404-js"><span class="toc-number">5.8.</span> <span class="toc-text">src/pages/404.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-pages-document-ejs"><span class="toc-number">5.9.</span> <span class="toc-text">src/pages/document.ejs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-pages-umi"><span class="toc-number">5.10.</span> <span class="toc-text">src/pages/.umi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-pages-umi-production"><span class="toc-number">5.11.</span> <span class="toc-text">src/pages/.umi-production</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#test-js-ts-和-e2e-js-ts"><span class="toc-number">5.12.</span> <span class="toc-text">.test.(js|ts) 和 .e2e.(js|ts)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-global-js-ts"><span class="toc-number">5.13.</span> <span class="toc-text">src/global.(js|ts)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-global-css-less-sass-scss"><span class="toc-number">5.14.</span> <span class="toc-text">src/global.(css|less|sass|scss)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#src-app-js-ts"><span class="toc-number">5.15.</span> <span class="toc-text">src/app.(js|ts)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#umirc-js-ts-和-config-config-js-ts"><span class="toc-number">5.16.</span> <span class="toc-text">.umirc.(js|ts) 和 config/config.(js|ts)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#env"><span class="toc-number">5.17.</span> <span class="toc-text">.env</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#路由（重点，umi已约定式路由为基础拓展）"><span class="toc-number">6.</span> <span class="toc-text">路由（重点，umi已约定式路由为基础拓展）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#约定式路由"><span class="toc-number">6.1.</span> <span class="toc-text">约定式路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基础路由"><span class="toc-number">6.1.1.</span> <span class="toc-text">基础路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态路由"><span class="toc-number">6.1.2.</span> <span class="toc-text">动态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可选的动态路由"><span class="toc-number">6.1.3.</span> <span class="toc-text">可选的动态路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#嵌套路由"><span class="toc-number">6.1.4.</span> <span class="toc-text">嵌套路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局-layout"><span class="toc-number">6.1.5.</span> <span class="toc-text">全局 layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同的全局-layout"><span class="toc-number">6.1.6.</span> <span class="toc-text">不同的全局 layout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#404-路由"><span class="toc-number">6.1.7.</span> <span class="toc-text">404 路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过注释扩展路由"><span class="toc-number">6.1.8.</span> <span class="toc-text">通过注释扩展路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置式路由"><span class="toc-number">6.2.</span> <span class="toc-text">配置式路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#权限路由"><span class="toc-number">6.3.</span> <span class="toc-text">权限路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由动效"><span class="toc-number">6.4.</span> <span class="toc-text">路由动效</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#面包屑"><span class="toc-number">6.5.</span> <span class="toc-text">面包屑</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启用-Hash-路由"><span class="toc-number">6.6.</span> <span class="toc-text">启用 Hash 路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Scroll-to-top"><span class="toc-number">6.7.</span> <span class="toc-text">Scroll to top</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#在页面间跳转"><span class="toc-number">7.</span> <span class="toc-text">在页面间跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#声明式"><span class="toc-number">7.1.</span> <span class="toc-text">声明式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令式"><span class="toc-number">7.2.</span> <span class="toc-text">命令式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置"><span class="toc-number">8.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#配置文件"><span class="toc-number">8.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#umirc-local-js"><span class="toc-number">8.2.</span> <span class="toc-text">.umirc.local.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UMI-ENV"><span class="toc-number">8.3.</span> <span class="toc-text">UMI_ENV</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HTML-模板"><span class="toc-number">9.</span> <span class="toc-text">HTML 模板</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#修改默认模板"><span class="toc-number">9.1.</span> <span class="toc-text">修改默认模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置模板"><span class="toc-number">9.2.</span> <span class="toc-text">配置模板</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#针对特定页面指定模板"><span class="toc-number">10.</span> <span class="toc-text">针对特定页面指定模板</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mock-数据"><span class="toc-number">11.</span> <span class="toc-text">Mock 数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-umi-的-mock-功能"><span class="toc-number">11.1.</span> <span class="toc-text">使用 umi 的 mock 功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引入-Mock-js"><span class="toc-number">11.2.</span> <span class="toc-text">引入 Mock.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#添加跨域请求头"><span class="toc-number">11.3.</span> <span class="toc-text">添加跨域请求头</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#合理的拆分你的-mock-文件"><span class="toc-number">11.4.</span> <span class="toc-text">合理的拆分你的 mock 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何模拟延迟"><span class="toc-number">11.5.</span> <span class="toc-text">如何模拟延迟</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手动添加-setTimeout-模拟延迟"><span class="toc-number">11.6.</span> <span class="toc-text">手动添加 setTimeout 模拟延迟</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用插件模拟延迟"><span class="toc-number">11.7.</span> <span class="toc-text">使用插件模拟延迟</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态-Mock-数据"><span class="toc-number">11.8.</span> <span class="toc-text">动态 Mock 数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#联调"><span class="toc-number">11.9.</span> <span class="toc-text">联调</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Use-umi-with-dva-重点"><span class="toc-number">12.</span> <span class="toc-text">Use umi with dva(重点)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#特性-1"><span class="toc-number">12.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-number">12.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#model-注册"><span class="toc-number">12.3.</span> <span class="toc-text">model 注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置及插件"><span class="toc-number">12.4.</span> <span class="toc-text">配置及插件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FAQ"><span class="toc-number">12.5.</span> <span class="toc-text">FAQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#url-变化了，但页面组件不刷新，是什么原因？"><span class="toc-number">12.5.1.</span> <span class="toc-text">url 变化了，但页面组件不刷新，是什么原因？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何访问到-store-或-dispatch-方法？"><span class="toc-number">12.5.2.</span> <span class="toc-text">如何访问到 store 或 dispatch 方法？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何禁用包括-component-和-models-的按需加载？"><span class="toc-number">12.5.3.</span> <span class="toc-text">如何禁用包括 component 和 models 的按需加载？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局-layout-使用-connect-后路由切换后没有刷新？"><span class="toc-number">12.5.4.</span> <span class="toc-text">全局 layout 使用 connect 后路由切换后没有刷新？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#按需加载"><span class="toc-number">13.</span> <span class="toc-text">按需加载</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#按需加载组件"><span class="toc-number">13.1.</span> <span class="toc-text">按需加载组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#按需加载模块"><span class="toc-number">13.2.</span> <span class="toc-text">按需加载模块</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#运行时配置"><span class="toc-number">14.</span> <span class="toc-text">运行时配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么有运行时配置？"><span class="toc-number">14.1.</span> <span class="toc-text">为什么有运行时配置？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置方式"><span class="toc-number">14.2.</span> <span class="toc-text">配置方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置列表"><span class="toc-number">14.3.</span> <span class="toc-text">配置列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#patchRoutes"><span class="toc-number">14.3.1.</span> <span class="toc-text">patchRoutes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#render"><span class="toc-number">14.3.2.</span> <span class="toc-text">render</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#onRouteChange"><span class="toc-number">14.3.3.</span> <span class="toc-text">onRouteChange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rootContainer"><span class="toc-number">14.3.4.</span> <span class="toc-text">rootContainer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#modifyRouteProps"><span class="toc-number">14.3.5.</span> <span class="toc-text">modifyRouteProps</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#区块（区块开发就不赘述了，比较高级的使用方法）"><span class="toc-number">15.</span> <span class="toc-text">区块（区块开发就不赘述了，比较高级的使用方法）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#部署"><span class="toc-number">16.</span> <span class="toc-text">部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#默认方案"><span class="toc-number">16.1.</span> <span class="toc-text">默认方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#不输出-html-文件"><span class="toc-number">16.2.</span> <span class="toc-text">不输出 html 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#部署-html-到非根目录"><span class="toc-number">16.3.</span> <span class="toc-text">部署 html 到非根目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-hashHistory"><span class="toc-number">16.4.</span> <span class="toc-text">使用 hashHistory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#按需加载-1"><span class="toc-number">16.5.</span> <span class="toc-text">按需加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态资源在非根目录或-cdn"><span class="toc-number">16.6.</span> <span class="toc-text">静态资源在非根目录或 cdn</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-runtime-的-publicPath"><span class="toc-number">16.7.</span> <span class="toc-text">使用 runtime 的 publicPath</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态化"><span class="toc-number">16.8.</span> <span class="toc-text">静态化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML-后缀"><span class="toc-number">16.9.</span> <span class="toc-text">HTML 后缀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态化后输出到任意路径"><span class="toc-number">16.10.</span> <span class="toc-text">静态化后输出到任意路径</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实战-写一个登陆及管理后台menu-demo"><span class="toc-number">17.</span> <span class="toc-text">实战-写一个登陆及管理后台menu demo</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#目录-1"><span class="toc-number">17.1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#首先定义utils下的request请求对象"><span class="toc-number">17.2.</span> <span class="toc-text">首先定义utils下的request请求对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在service下export出在model中调用的api-func"><span class="toc-number">17.3.</span> <span class="toc-text">在service下export出在model中调用的api func</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定义model对象"><span class="toc-number">17.4.</span> <span class="toc-text">定义model对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mock-index-js加些mock数据"><span class="toc-number">17.5.</span> <span class="toc-text">mock/index.js加些mock数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#login页面（antd）-，-接口调用及路由跳转"><span class="toc-number">17.6.</span> <span class="toc-text">login页面（antd） ， 接口调用及路由跳转</span></a></li></ol></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    
        <div id="gitments"></div>
<script src="/js/gitment.browser.js"></script>
<script>
    var gitment = new Gitment({
      id: window.location.pathname,
      owner: 'GapGao',
      repo: 'gapgao.github.io',
      oauth: {
        client_id: 'b37cf634d1c116549841',
        client_secret: '54bad933f4f25c63418d4c79fe77cbbba1c465b5',
      },
    })
    gitment.render('gitments')
</script>
    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2019/06/01/vConsole调试console/" title="上一篇: vConsole调试console">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2019/04/27/学习计划/" title="下一篇: 学习计划">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/12/28/rn/">RN开发与使用Expo+EAS打包发布及配套苹果开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/02/28/vite是什么/">vite是什么</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/10/19/vue3之初体验/">vue3之初体验</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/21/前端自动化测试（三）- E2E测试/">前端自动化测试（三）- E2E测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/22/前端自动化测试（二）- 单元测试/">前端自动化测试（二）- 单元测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/25/前端自动化测试（一）/">前端自动化测试（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/28/初探Deno/">初探Deno</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/17/webpack-rollup-parcel/">webpack-rollup-parcel</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/17/AST抽象语法树/">AST抽象语法树</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/25/ES6-Proxy能干点啥/">ES6-Proxy 能干点啥</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/29/我爱读源码系列之飞冰配置式路由/">我爱读源码系列之飞冰配置式路由</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/23/搞懂CJS&UMD&ESM/">搞懂CJS & UMD & ESM</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/31/react15升16/">react15升16</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/17/小程序开发笔记/">小程序开发笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/21/深入理解JavaScript的设计模式/">深入理解JavaScript的设计模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/24/用preload预加载页面资源/">用preload预加载页面资源</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/25/初探WebAssembly/">初探WebAssembly</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/25/完全理解react Fiber/">完全理解react Fiber</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/20/Nuxt-express踩坑日记/">Nuxt+express踩坑日记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/01/本地微信真机调试方法/">本地微信真机调试方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/01/chrome模拟微信浏览器device/">chrome模拟微信浏览器device</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/01/vConsole调试console/">vConsole调试console</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/09/umi实战笔记/">umi实战笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/27/学习计划/">学习计划</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2024 GapGao
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit">到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


    <script type="text/javascript">
      window.onload = function(){
        document.getElementById("search").onclick = function(){
            console.log("search")
            search();
        }
      }
      function search(){
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','A1Pz-LKMXbrzcFg2FWi6','2.0.0');
      }
    </script>

  </div>
</body>
</html>